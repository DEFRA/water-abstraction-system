{% extends 'layout-licences.njk' %}

{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "macros/licence-version-change-type-tag.njk" import changeTypeTag as licenceVersionChangeTypeTag %}

{% block subPageContent %}
  {% if entries.length === 0 %}
    <p>No history for this licence.</p>
  {% else %}
    {% set tableRows = [] %}
    {% for licenceVersion in licenceVersions %}
      {% set rowIndex = loop.index0 %}

      {% set dataRow = [
        {
          text: licenceVersion.startDate,
          attributes: { 'data-test': 'licenceVersion-start-date-' + rowIndex },
          classes: classes
        },
        {
          text: licenceVersion.endDate,
          attributes: { 'data-test': 'licenceVersion-end-date-' + rowIndex },
          classes: classes
        },
        {
          text: licenceVersion.reason,
          attributes: { 'data-test': 'licenceVersion-reason-' + rowIndex },
          classes: classes
        },
        {
          html: licenceVersionChangeTypeTag(licenceVersion.changeType, true)
        },
        {
          html: '<a href="'+ licenceVersion.action.link +'" class="govuk-link">' + licenceVersion.action.text + '</a>',
          attributes: { 'data-test': 'action-' + rowIndex }
        }
      ] %}


      {% set tableRows = (tableRows.push(dataRow), tableRows) %}
    {% endfor %}

    {{ govukTable({
      attributes: { 'data-test': 'bills-table' },
      caption: "Showing all licence versions imported into the service.",
      captionClasses: "govuk-table__caption--m govuk-!-font-weight-regular",
      firstCellIsHeader: false,
      head: [
        { text: 'Start date' },
        { text: 'End date' },
        { text: 'Reason' },
        { text: 'Change type' },
        { text: 'Action' }
      ],
      rows: tableRows
    }) }}
  {% endif %}
{% endblock %}
