{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "macros/charge-version-status-tag.njk" import statusTag %}

{% macro createLink(chargeVersion) %}
  {% for chargeVersionAction in chargeVersion.action %}
    {% if not loop.first %} | {% endif %}
    <a href="{{ chargeVersionAction.link }}" class="govuk-link">
      {{ chargeVersionAction.text }} </a>
  {% endfor %}
{% endmacro %}

{% set chargeVersionRows = [] %}

{% set chargeVersionHead = [
  {
    text: "Start date"
  },
  {
    text: "End date"
  },
  {
    text: "Reason"
  },
  {
    text: "Status"
  },
  {
    text: "Action"
  }
] %}

{% for chargeVersion in  chargeInformation %}
  {% set chargeVersionRows = (chargeVersionRows.push([
    {
      text: chargeVersion.startDate
    },
    {
      text: chargeVersion.endDate
    },
    {
      text: chargeVersion.reason
    },
    {
      html: statusTag(chargeVersion.status)
    },
    {
      html: createLink(chargeVersion)
    }
  ]), chargeVersionRows) %}
{% endfor %}

<h2 class="govuk-heading-l">Licence set up</h2>

<h3 class="govuk-heading-m"> Charge information </h3>

{% if chargeInformation.length == 0 %}
  <p class="govuk-body"> No charge information for this licence.</p>
{% endif %}

{% if chargeInformation.length > 0 %}
  {{ govukTable({
    head: chargeVersionHead,
    rows: chargeVersionRows
  }) }}
{% endif %}

{% if setupNewCharge %}
  {{ govukButton({
    text: "Set up a new charge",
    href: setupNewCharge,
    classes: "govuk-button--secondary govuk-!-margin-right-3"
  }) }}
{% endif %}

{% if makeLicenceNonChargeable %}
  {{ govukButton({
    text: "Make licence non-chargeable",
    href: makeLicenceNonChargeable,
    classes: "govuk-button--secondary"
  }) }}
{% endif %}

<hr />

{% set agreementRows = [] %}

{% set agreementHead = [
  {
    text: "Start date"
  },
  {
    text: "End date"
  },
  {
    text: "Agreement"
  },
  {
    text: "Date signed"
  },
  {
    text: "Action"
  }
] %}

{% for agreement in  agreements %}
  {% set agreementRows = (agreementRows.push([
    {
      text: agreement.startDate
    },
    {
      text: agreement.endDate
    },
    {
      text: agreement.description
    },
    {
      text: agreement.signedDate
    },
    {
      html: createLink(agreement)
    }
  ]), agreementRows) %}
{% endfor %}


<h3 class="govuk-heading-m"> Agreements </h3>

{% if agreements.length == 0 %}
  <p class="govuk-body"> No agreements for this licence.</p>
{% endif %}

{% if agreements.length > 0 %}
  {{ govukTable({
    head: agreementHead,
    rows: agreementRows
  }) }}
{% endif %}


{% if setUpAgreement %}
  {{ govukButton({
    text: "Set up a new agreement",
    href: setUpAgreement,
    classes: "govuk-button--secondary"
  }) }}
{% endif %}
