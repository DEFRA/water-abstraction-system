{% from "govuk/components/pagination/macro.njk" import govukPagination %}
{% from "govuk/components/table/macro.njk" import govukTable %}

{% from "macros/return-status-tag.njk" import statusTag %}

<h2 class="govuk-heading-l">Returns</h2>

{% if noReturnsMessage %}
  <p> {{ noReturnsMessage }} </p>
{% else %}

  {% macro referenceColumn(return) %}
    <a href="{{ return.link }}" class="govuk-link">{{ return.reference }} </a>
    <p class="govuk-body-s"> {{ return.dates }}</p>
  {% endmacro %}

  {% set returnRows = [] %}

  {% for returnItem in  returns %}
    {# Set an easier to use index. Also means we can refer to it inside our elementDetail loop #}
    {% set rowIndex = loop.index0 %}

    {% set returnStatusTag %}
      {{ statusTag(returnItem.status, true) }}
    {% endset %}

    {% set returnRows = (returnRows.push([
      {
        html: referenceColumn(returnItem),
        attributes: { 'data-test': 'return-reference-' + rowIndex }
      },
      {
        html:  returnItem.purpose +  "<p class=\"govuk-body-s\">" + returnItem.description + "</p>",
        attributes: { 'data-test': 'return-purpose-' + rowIndex }
      },
      {
        text: returnItem.dueDate,
        attributes: { 'data-test': 'return-due-date-' + rowIndex }
      },
      {
        html: returnStatusTag,
        attributes: { 'data-test': 'return-status-' + rowIndex }
      }
    ]), returnRows) %}
  {% endfor %}

  {{ govukTable({
    head: [
      {
        text: 'Return reference and dates'
      },
      {
        text: 'Purpose and description'
      },
      {
        text: 'Due date'
      },
      {
        text: 'Status'
      }
    ],
    rows: returnRows
  }) }}
{% endif %}

{% if pagination.numberOfPages > 1 %}
  {{ govukPagination(pagination.component) }}
{% endif %}
