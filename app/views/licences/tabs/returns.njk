{% from "govuk/components/pagination/macro.njk" import govukPagination %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/tag/macro.njk" import govukTag %}

{% macro formatStatus(status) %}
  {% if status === 'COMPLETE' %}
    {{ govukTag({
      text: status,
      classes: "govuk-tag--green"
    }) }}

  {% elseif status === 'OVERDUE' %}
    {{ govukTag({
      text: status,
      classes: "govuk-tag--red"
    }) }}
  {% else %}
    {{ status }}
  {% endif %}
{% endmacro %}

<h2 class="govuk-heading-l">Returns</h2>

{% if noReturnsMessage %}
  <p> {{ noReturnsMessage }} </p>
{% else %}

  {% macro referenceColumn(return) %}
    <a href="/return/internal?returnId={{ return.id }}" class="govuk-link">{{ return.reference }} </a>
    <p class="govuk-body-s"> {{ return.dates }}</p>
  {% endmacro %}

  {% set returnRows = [] %}

  {% for returnItem in  returns %}
    {% set returnRows = (returnRows.push([
      {
        html: referenceColumn(returnItem)
      },
      {
        html:  returnItem.purpose +  "<p class=\"govuk-body-s\">" + returnItem.description + "</p>"
      },
      {
        text: returnItem.dueDate
      },
      {
        html: formatStatus(returnItem.status)
      }
    ]), returnRows) %}
  {% endfor %}

  {{ govukTable({
    head: [
      {
        text: 'Return reference and dates'
      },
      {
        text: 'Purpose and description'
      },
      {
        text: 'Due date'
      },
      {
        text: 'Status'
      }
    ],
    rows: returnRows
  }) }}
{% endif %}

{% if pagination.numberOfPages > 1 %}
  {{ govukPagination(pagination.component) }}
{% endif %}

