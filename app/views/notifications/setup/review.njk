{% extends 'layout.njk' %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/radios/macro.njk" import govukRadios %}
{% from 'govuk/components/error-summary/macro.njk' import govukErrorSummary %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/details/macro.njk" import govukDetails %}
{% from "govuk/components/pagination/macro.njk" import govukPagination %}

{% block breadcrumbs %}
  {{ govukBackLink({
    text: 'Back',
    href: "returns-period"
  }) }}
{% endblock %}

{% macro newLine(array) %}
  {% for item in array %}
    <p class="govuk-!-margin-bottom-1">
      {{ item }}</p>
  {% endfor %}
{% endmacro %}

{% set rows = [] %}

{%for recipient in recipients %}
  {% set licenceNumbers %}
  {% if recipient.licences.length > 5 %}
    {{
            govukDetails({
              classes: 'govuk-!-margin-bottom-0',
              summaryText: 'licence numbers',
              html: newLine(recipient.licences)
            })
          }}
  {% else %}
    {{ newLine(recipient.licences)  }}
  {% endif %}
  {% endset %}

  {% set rows = (rows.push([
    {
      text: newLine(recipient.contact)
    }, {
      html: licenceNumbers
    }, {
      text: recipient.method
    }
  ]), rows) %}
{% endfor %}

{% block content %}
  <div class="govuk-body">
    <h1 class="govuk-heading-l">{{ pageTitle }}</h1>
`
    {{ govukTable({
      caption: "Recipients",
      captionClasses: "govuk-table__caption--m",
      firstCellIsHeader: false,
      head: [
        {
          text: "Recipient",
          classes: "govuk-!-width-one-third"
        },
        {
          text: "Licence Numbers",
          classes: "govuk-!-width-one-third"
        },
        {
          text: "Method",
          classes: "govuk-!-width-one-third"
        }
      ],
      rows: rows
    }) }}

    {% if pagination.numberOfPages > 1 %}
      {{ govukPagination(pagination.component) }}
    {% endif %}

    <form method="post">
      <input type="hidden" name="wrlsCrumb" value="{{ wrlsCrumb }}"/>

      {{ govukButton({ text: "Send " + recipientsAmount + " invitations", preventDoubleClick: true }) }}
    </form>
  </div>
{% endblock %}